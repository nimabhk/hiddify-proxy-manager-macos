# Hiddify Smart Proxy Manager for macOS 

یک اسکریپت هوشمند برای مدیریت خودکار پراکسی سیستم در macOS هنگام استفاده از کلاینت Hiddify. این اسکریپت به طور خودکار پراکسی‌های سیستم را بر اساس وضعیت اتصال هیدیفای (وصل/قطع) تنظیم کرده و مشکلات رایج مانند باقی‌ماندن پراکسی پس از قطع اتصال را برطرف می‌کند.

[![macOS](https://img.shields.io/badge/macOS-Sequoia%2015.5%2B-blue.svg)](https://www.apple.com/macos/sequoia-preview/)
[![Shell Script](https://img.shields.io/badge/Shell-Bash-lightgrey.svg)](https://www.gnu.org/software/bash/)
[![License](https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg)](https://creativecommons.org/licenses/by-nc-sa/4.0/)

---

### این اسکریپت چه مشکلی را حل می‌کند؟

بسیاری از کاربران ترجیح می‌دهند از Hiddify در حالت **System Proxy** به جای حالت **VPN (TUN)** استفاده کنند، به خصوص زمانی که از نرم‌افزارهای دیگری مانند AdGuard که خود از حالت VPN استفاده می‌کنند، بهره می‌برند. با این حال، حالت پراکسی معایب خود را دارد:
- **باقی ماندن پراکسی:** گاهی پس از قطع اتصال یا بسته شدن ناگهانی Hiddify، تنظیمات پراکسی سیستم به حالت اولیه باز نمی‌گردد و باعث قطع شدن کل اینترنت می‌شود.
- **تداخل با پراکسی‌های دیگر:** مدیریت همزمان پراکسی هیدیفای با پراکسی‌های دیگر (مانند پراکسی محل کار) دشوار است.
- **نیاز به تنظیم دستی:** فعال و غیرفعال کردن دستی پراکسی‌ها با هر بار اتصال، خسته‌کننده است.

این اسکریپت تمام این فرآیندها را به صورت هوشمند و در پس‌زمینه مدیریت می‌کند.

### ✨ قابلیت‌ها

- **اتصال و قطع خودکار:** پراکسی‌های سیستم همزمان با اتصال شما به هیدیفای **روشن** و با قطع اتصال **خاموش** می‌شوند.
- **پشتیبان‌گیری و بازیابی هوشمند:** اگر قبل از اتصال به هیدیفای از پراکسی دیگری استفاده می‌کنید، اسکریپت تنظیمات آن را **پشتیبان‌گیری** کرده و پس از قطع اتصال هیدیفای، آن را **بازیابی** می‌کند.
- **احترام به تصمیم کاربر:** اگر در حین اتصال، یک پراکسی را به صورت دستی تغییر دهید یا خاموش کنید، اسکریپت این تغییر را تشخیص داده و تا زمان اتصال مجدد، به انتخاب شما **احترام می‌گذارد**.
- **پاک‌سازی خودکار:** پراکسی‌هایی که به اشتباه با تنظیمات هیدیفای روشن مانده‌اند را شناسایی و غیرفعال می‌کند.
- **گزارش‌دهی کامل:** تمام فعالیت‌ها در یک فایل لاگ ثبت می‌شوند تا عیب‌یابی آسان باشد.
- **نصب‌کننده خودکار:** دارای یک اسکریپت نصب آسان برای خودکارسازی تمام مراحل.

### ✅ پیش‌نیازها

- سیستم‌عامل **macOS** (تست و عیب‌یابی شده روی Sequoia 15.5 و Sonoma 14).
- کلاینت **Hiddify** (نسخه ۲.۵.۷ و بالاتر).
- دسترسی به **Terminal**.

---

### 🚀 نصب

دو روش برای نصب وجود دارد: آسان و دستی.

#### روش ۱: نصب آسان (توصیه شده)

1.  ابتدا این مخزن را دانلود کنید (از طریق Clone یا دانلود ZIP).
2.  ترمینال را باز کرده و با دستور `cd` به پوشه دانلود شده بروید.
3.  دستور زیر را اجرا کنید:
    ```bash
    chmod +x install.sh
    ./install.sh
    ```
4.  نصب‌کننده از شما **پورت Mixed** هیدیفای را می‌پرسد (مقدار پیش‌فرض `12334` است). این پورت را از تنظیمات برنامه Hiddify در بخش `Config Options > Inbound Options > Mixed Port` پیدا کنید.
5.  مراحل پایانی که مربوط به دادن دسترسی **Full Disk Access** است را طبق دستورالعمل نصب‌کننده انجام دهید.

#### روش ۲: نصب دستی (برای کاربران حرفه‌ای)

<details>
<summary>برای مشاهده مراحل نصب دستی اینجا کلیک کنید</summary>

1.  **کپی فایل‌ها:**
    - فایل `manager.sh` را در یک مسیر دلخواه و دائمی کپی کنید (مثلاً `~/scripts/hiddify-manager/`).
    - فایل `template.plist` را نیز در همان مسیر کپی کنید.

2.  **پیکربندی اسکریپت:**
    - فایل `manager.sh` را باز کرده و در بخش `CONFIGURATION`، مقدار `HIDDIFY_PORT` را با پورت Mixed خودتان جایگزین کنید.

3.  **پیکربندی فایل سرویس:**
    - فایل `template.plist` را باز کنید.
    - عبارت `PLACEHOLDER_SCRIPT_PATH` را با مسیر کامل و دقیق فایل `manager.sh` جایگزین کنید (مثلاً `/Users/your_username/scripts/hiddify-manager/manager.sh`).
    - نام فایل را به `com.user.hiddifyproxymanager.plist` تغییر دهید.

4.  **کپی و فعال‌سازی سرویس:**
    - فایل `com.user.hiddifyproxymanager.plist` را به مسیر `~/Library/LaunchAgents/` منتقل کنید.
    - سرویس را با دستور زیر در ترمینال فعال کنید:
      ```bash
      launchctl load ~/Library/LaunchAgents/com.user.hiddifyproxymanager.plist
      ```

5.  **دادن دسترسی Full Disk Access:**
    - به `System Settings > Privacy & Security > Full Disk Access` بروید.
    - با زدن دکمه `+`، فایل `/bin/bash` را به لیست اضافه کرده و آن را فعال کنید.

</details>

---

### 🔧 عیب‌یابی (Troubleshooting)

اگر اسکریپت به درستی کار نمی‌کند، لاگ‌های آن بهترین راهنما برای شما هستند. آن‌ها را در مسیر `/tmp/` پیدا کنید:
- **لاگ اصلی:** `/tmp/hiddify_proxy.log`
- **لاگ خطاها:** `/tmp/hiddify_proxy.stderr.log`

با دستور `tail -f /tmp/hiddify_proxy.log` می‌توانید عملکرد زنده اسکریپت را مشاهده کنید. رایج‌ترین مشکل، عدم اعطای دسترسی **Full Disk Access** است که منجر به خطای `Operation not permitted` می‌شود.

### 🗑️ حذف (Uninstall)

برای حذف کامل اسکریپت، دستور زیر را در پوشه اصلی پروژه اجرا کنید:
```bash
./install.sh uninstall
```
این دستور سرویس را متوقف کرده و تمام فایل‌های مربوطه را پاک می‌کند.

---

### 💼 استفاده تجاری و لایسنس

این نرم‌افزار برای استفاده شخصی و غیرتجاری رایگان است. ویرایش، ارتقا و بازنشر آن به شرط ارجاع به صفحه گیت‌هاب اصلی مجاز است. هرگونه بازنشر باید تحت همین لایسنس صورت گیرد.

**برای موارد زیر نیاز به تهیه لایسنس تجاری است:**
- استفاده در شرکت‌های با بیش از ۵ کارمند.
- هرگونه استفاده مستقیم تجاری (حتی توسط یک نفر).
- استفاده از بخشی از این اسکریپت در یک محصول نرم‌افزاری دیگر.

برای تهیه لایسنس تجاری، لطفاً با من تماس بگیرید: **moderndesigner@outlook.com**

### 💰 حمایت مالی (Donation)

اگر این اسکریپت برای شما مفید بوده و تمایل به حمایت از توسعه آن دارید، می‌توانید از طریق آدرس‌های زیر اقدام کنید. از شما متشکرم!

- **BTC (Bitcoin):** `bc1pjrvk5r5um3hy4q8zzp40ecmfmhcpwhlx4t9nxrdc8etupz8qnmfqx2weqp`
- **BTCB, ETH, USDT, BNB n all EVMs (Evm, Bsc Bep20, Arbitrom):** `0xbb1F9f7868416C3eB9DEfc075aD3d1Fb5c36699F`
- **USDT (TRC20 Tron):** `TAcUvvVNU1c6F21cfkKKwdm2RUE5YnTzsS`
- **TON (TON):** `UQC0fjghhRzO-Xo-n0MmMa8eSvn10Y8UB1s8qr09LT6DXVjO`
- **SOL (Solana):** `Fp4uWu1dLRDeWvSxufh8BWm48FnFsLQwXNLDk6bbYFr1`
- **XRP (Ripple):** `rUXpNRn989XQ1nJyvfHvL2BgndAgZToL33`

### 🤝 مشارکت و ارجاع به تیم هیدیفای

اگر این اسکریپت برای شما مفید بود، می‌توانید آن را به توسعه‌دهندگان Hiddify معرفی کنید. بهترین راه برای این کار، ایجاد یک "بحث" (Discussion) یا "مسئله" (Issue) در [مخزن گیت‌هاب Hiddify App](https://github.com/hiddify/hiddify-app) است.

در پیام خود می‌توانید توضیح دهید که این اسکریپت چه مشکلی را حل می‌کند و لینک این مخزن را برای بررسی آن‌ها قرار دهید. این کار می‌تواند به بهبود تجربه کاربری تمام کاربران هیدیفای در macOS کمک کند.

### 📜 مجوز (License)

این پروژه تحت مجوز [Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International](https://creativecommons.org/licenses/by-nc-sa/4.0/) منتشر شده است.
